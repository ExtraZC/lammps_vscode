

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.3. Link LAMMPS as a library to another code &mdash; LAMMPS documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="LAMMPS documentation" href="index.html"/>
        <link rel="up" title="3. Build LAMMPS" href="Build.html"/>
        <link rel="next" title="3.4. Basic build options" href="Build_basics.html"/>
        <link rel="prev" title="3.2. Build LAMMPS with make" href="Build_make.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="Manual.html">
        

        
          
          <img src="_static/lammps-logo.png" class="logo" />
        
        </a>

        <div class="lammps_version">Version: <b>19 Mar 2020</b></div>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">2. Install LAMMPS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Build.html">3. Build LAMMPS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Build_cmake.html">3.1. Build LAMMPS with CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_make.html">3.2. Build LAMMPS with make</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. Link LAMMPS as a library to another code</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_basics.html">3.4. Basic build options</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_settings.html">3.5. Optional build settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_package.html">3.6. Include packages in build</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_extras.html">3.7. Packages with extra build options</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_windows.html">3.8. Notes for building LAMMPS on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="Build_development.html">3.9. Development build options (CMake only)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Run_head.html">4. Run LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Commands.html">5. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Packages.html">6. Optional packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Speed.html">7. Accelerate performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Howto.html">8. Howto discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">9. Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">10. Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modify.html">11. Modify &amp; extend LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_head.html">12. Use Python with LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Errors.html">13. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Manual_build.html">14. Building the LAMMPS manual</a></li>
</ul>
<p class="caption"><span class="caption-text">Index</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="commands_list.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixes.html">Fixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="computes.html">Computes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairs.html">Pair Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonds.html">Bond Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="angles.html">Angle Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dihedrals.html">Dihedral Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="impropers.html">Improper Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="fix_modify_atc_commands.html">fix_modify AtC commands</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="Manual.html">LAMMPS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="Manual.html">Docs</a> &raquo;</li>
      
          <li><a href="Build.html"><span class="section-number">3. </span>Build LAMMPS</a> &raquo;</li>
      
    <li><span class="section-number">3.3. </span>Link LAMMPS as a library to another code</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="http://lammps.sandia.gov">Website</a>
            <a href="Commands_all.html">Commands</a>
        
      </li>
  </ul>
  <hr style="margin-top: 6px; margin-bottom: 6px;" width="100%"/>
  
    <div class="rst-footer-buttons" style="margin-bottom: 1em" role="navigation" aria-label="footer navigation">
      
        <a href="Build_basics.html" class="btn btn-neutral float-right" title="3.4. Basic build options" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Build_make.html" class="btn btn-neutral" title="3.2. Build LAMMPS with make" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="link-lammps-as-a-library-to-another-code">
<h1><span class="section-number">3.3. </span>Link LAMMPS as a library to another code</h1>
<p>LAMMPS can be used as a library by another application, including
Python scripts.  The files src/library.cpp and library.h define the
C-style API for using LAMMPS as a library.  See the <a class="reference internal" href="Howto_library.html"><span class="doc">Howto
library</span></a> doc page for a description of the interface
and how to extend it for your needs.</p>
<p>The <a class="reference internal" href="Build_basics.html"><span class="doc">Build basics</span></a> doc page explains how to build
LAMMPS as either a shared or static library.  This results in one of
these 2 files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>liblammps.so      <span class="c1"># shared library</span>
liblammps.a       <span class="c1"># static library</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Care should be taken to use the same MPI library for the calling
code and the LAMMPS library.  The library.h file includes mpi.h and
uses definitions from it so those need to be available and
consistent.  When LAMMPS is compiled with the MPI STUBS library,
then its mpi.h file needs to be included.  While it is technically
possible to use a full MPI library in the calling code and link to
a serial LAMMPS library compiled with MPI STUBS, it is recommended
to use the <em>same</em> MPI library for both, and then use MPI_Comm_split()
in the calling code to pass a suitable communicator with a subset
of MPI ranks to the function creating the LAMMPS instance.</p>
</div>
<hr class="docutils" />
<p><strong>Link with LAMMPS as a static library</strong>:</p>
<p>The calling application can link to LAMMPS as a static library with
compilation and link commands as in the examples shown below.  These
are examples for a code written in C in the file <em>caller.c</em>.
The benefit of linking to a static library is, that the resulting
executable is independent of that library since all required
executable code from the library is copied into the calling executable.</p>
<p><em>CMake build</em>:</p>
<p>This assumes that LAMMPS has been configured with “-D BUILD_LIB=yes”
and installed with “make install” and the PKG_CONFIG_PATH environment
variable updated to include the <em>liblammps.pc</em> file installed into the
configured destination folder, if needed.  The commands to compile and
link the coupled executable are then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpicc -c -O <span class="k">$(</span>pkgconf liblammps --cflags<span class="k">)</span> caller.c
mpicxx -o <span class="nb">caller</span> caller.o -<span class="k">$(</span>pkgconf liblammps --libs<span class="k">)</span>
</pre></div>
</div>
<p><em>Traditional make</em>:</p>
<p>This assumes that LAMMPS has been compiled in the folder
“${HOME}/lammps/src” with “make mode=lib mpi”. The commands to compile
and link the coupled executable are then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpicc -c -O -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src caller.c
mpicxx -o <span class="nb">caller</span> caller.o -L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src -llammps
</pre></div>
</div>
<p>The <em>-I</em> argument is the path to the location of the <em>library.h</em>
header file containing the interface to the LAMMPS C-style library
interface.  The <em>-L</em> argument is the path to where the <em>liblammps.a</em>
file is located.  The <em>-llammps</em> argument is shorthand for telling the
compiler to link the file <em>liblammps.a</em>.</p>
<p>However, it is only as simple as shown above for the case of a plain
LAMMPS library without any optional packages that depend on libraries
(bundled or external).  Otherwise, you need to include all flags,
libraries, and paths for the coupled executable, that are also
required to link the LAMMPS executable.</p>
<p><em>CMake build</em>:</p>
<p>When using CMake, additional libraries with sources in the lib folder
are built, but not included in liblammps.a and (currently) not
installed with “make install” and not included in the <em>pkgconfig</em>
configuration file.  They can be found in the top level build folder,
but you have to determine the necessary link flags manually.  It is
therefore recommended to either use the traditional make procedure to
build and link with a static library or build and link with a shared
library instead.</p>
<p><em>Traditional make</em>:</p>
<p>After you have compiled a static LAMMPS library using the conventional
build system for example with “make mode=lib serial”. And you also
have installed the POEMS package after building its bundled library in
lib/poems. Then the commands to build and link the coupled executable
change to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcc -c -O -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src/STUBS -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src -caller.c
g++ -o <span class="nb">caller</span> caller.o -L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/lib/poems <span class="se">\</span>
  -L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src/STUBS -L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src -llammps -lpoems -lmpi_stubs
</pre></div>
</div>
<p>Note, that you need to link with “g++” instead of “gcc”, since LAMMPS
is C++ code.  You can display the currently applied settings for building
LAMMPS for the “serial” machine target by using the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make <span class="nv">mode</span><span class="o">=</span>print serial
</pre></div>
</div>
<p>Which should output something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compiler:</span>
<span class="nv">CXX</span><span class="o">=</span>g++
<span class="c1"># Linker:</span>
<span class="nv">LD</span><span class="o">=</span>g++
<span class="c1"># Compilation:</span>
<span class="nv">CXXFLAGS</span><span class="o">=</span>-g -O3 -DLAMMPS_GZIP -DLAMMPS_MEMALIGN<span class="o">=</span><span class="m">64</span> -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/lib/poems -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src/STUBS
<span class="c1"># Linking:</span>
<span class="nv">LDFLAGS</span><span class="o">=</span>-g -O
<span class="c1"># Libraries:</span>
<span class="nv">LDLIBS</span><span class="o">=</span>-L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/lib/poems -L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src/STUBS -lpoems -lmpi_stubs
</pre></div>
</div>
<p>From this you can gather the necessary paths and flags.  With
makefiles for other <em>machine</em> configurations you need to do the
equivalent and replace “serial” with the corresponding <em>machine</em> name
of the makefile.</p>
<hr class="docutils" />
<p><strong>Link with LAMMPS as a shared library</strong>:</p>
<p>When linking to LAMMPS built as a shared library, the situation
becomes much simpler, as all dependent libraries and objects are
included in the shared library, which is - technically speaking -
effectively a regular LAMMPS executable that is missing the <cite>main()</cite>
function.  Thus those libraries need not to be specified when linking
the calling executable.  Only the <em>-I</em> flags are needed.  So the
example case from above of the serial version static LAMMPS library
with the POEMS package installed becomes:</p>
<p><em>CMake build</em>:</p>
<p>The commands with a shared LAMMPS library compiled with the CMake
build process are the same as for the static library.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpicc -c -O <span class="k">$(</span>pkgconf liblammps --cflags<span class="k">)</span> caller.c
mpicxx -o <span class="nb">caller</span> caller.o -<span class="k">$(</span>pkgconf --libs<span class="k">)</span>
</pre></div>
</div>
<p><em>Traditional make</em>:</p>
<p>The commands with a shared LAMMPS library compiled with the
traditional make build using “make mode=shlib serial” becomes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcc -c -O -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src/STUBS -I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src -caller.c
g++ -o <span class="nb">caller</span> caller.o -L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src -llammps
</pre></div>
</div>
<p><em>Locating liblammps.so at runtime</em>:</p>
<p>However, now the <cite>liblammps.so</cite> file is required at runtime and needs
to be in a folder, where the shared linker program of the operating
system can find it.  This would be either a folder like “/usr/local/lib64”
or “${HOME}/.local/lib64” or a folder pointed to by the LD_LIBRARY_PATH
environment variable. You can type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>printenv LD_LIBRARY_PATH
</pre></div>
</div>
<p>to see what directories are in that list.</p>
<p>Or you can add the LAMMPS src directory (or the directory you performed
a CMake style build in) to your LD_LIBRARY_PATH, so that the current
version of the shared library is always available to programs that use it.</p>
<p>For the Bourne or Korn shells (/bin/sh, /bin/ksh, /bin/bash etc.), you
would add something like this to your ~/.profile file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>LD_LIBRARY_PATH <span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">-/usr/lib64</span><span class="si">}</span>:<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/lammps/src
<span class="nb">export</span> LD_LIBRARY_PATH
</pre></div>
</div>
<p>For the csh or tcsh shells, you would equivalently add something like this
to your ~/.cshrc file:</p>
<div class="highlight-csh notranslate"><div class="highlight"><pre><span></span><span class="nb">setenv </span>LD_LIBRARY_PATH <span class="k">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="k">}</span>:<span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/lammps/src
</pre></div>
</div>
<p>You can verify whether all required shared libraries are found with the
<cite>ldd</cite> tool.  Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/home/user/lammps/src ldd <span class="nb">caller</span>
     linux-vdso.so.1 <span class="o">(</span>0x00007ffe729e0000<span class="o">)</span>
     liblammps.so <span class="o">=</span>&gt; /home/user/lammps/src/liblammps.so <span class="o">(</span>0x00007fc91bb9e000<span class="o">)</span>
     libstdc++.so.6 <span class="o">=</span>&gt; /lib64/libstdc++.so.6 <span class="o">(</span>0x00007fc91b984000<span class="o">)</span>
     libm.so.6 <span class="o">=</span>&gt; /lib64/libm.so.6 <span class="o">(</span>0x00007fc91b83e000<span class="o">)</span>
     libgcc_s.so.1 <span class="o">=</span>&gt; /lib64/libgcc_s.so.1 <span class="o">(</span>0x00007fc91b824000<span class="o">)</span>
     libc.so.6 <span class="o">=</span>&gt; /lib64/libc.so.6 <span class="o">(</span>0x00007fc91b65b000<span class="o">)</span>
     /lib64/ld-linux-x86-64.so.2 <span class="o">(</span>0x00007fc91c094000<span class="o">)</span>
</pre></div>
</div>
<p>If a required library is missing, you would get a ‘not found’ entry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$  ldd <span class="nb">caller</span>
     linux-vdso.so.1 <span class="o">(</span>0x00007ffd672fe000<span class="o">)</span>
     liblammps.so <span class="o">=</span>&gt; not found
     libstdc++.so.6 <span class="o">=</span>&gt; /usr/lib64/libstdc++.so.6 <span class="o">(</span>0x00007fb7c7e86000<span class="o">)</span>
     libm.so.6 <span class="o">=</span>&gt; /usr/lib64/libm.so.6 <span class="o">(</span>0x00007fb7c7d40000<span class="o">)</span>
     libgcc_s.so.1 <span class="o">=</span>&gt; /usr/lib64/libgcc_s.so.1 <span class="o">(</span>0x00007fb7c7d26000<span class="o">)</span>
     libc.so.6 <span class="o">=</span>&gt; /usr/lib64/libc.so.6 <span class="o">(</span>0x00007fb7c7b5d000<span class="o">)</span>
     /lib64/ld-linux-x86-64.so.2 <span class="o">(</span>0x00007fb7c80a2000<span class="o">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Calling the LAMMPS library</strong>:</p>
<p>Either flavor of library (static or shared) allows one or more LAMMPS
objects to be instantiated from the calling program. When used from a
C++ program, most of the symbols and functions in LAMMPS are wrapped
in a LAMMPS_NS namespace; you can safely use any of its classes and
methods from within the calling code, as needed, and you will not incur
conflicts with functions and variables in your code that share the name.
This, however, does not extend to all additional libraries bundled with
LAMMPS in the lib folder and some of the low-level code of some packages.</p>
<p>To be compatible with C, Fortran, Python programs, the library has a simple
C-style interface, provided in src/library.cpp and src/library.h.</p>
<p>See the <a class="reference internal" href="Python_library.html"><span class="doc">Python library</span></a> doc page for a
description of the Python interface to LAMMPS, which wraps the C-style
interface from a shared library through the <a class="reference external" href="https://docs.python.org/3/library/ctypes.html">ctypes python module</a>.</p>
<p>See the sample codes in examples/COUPLE/simple for examples of C++ and
C and Fortran codes that invoke LAMMPS through its library interface.
Other examples in the COUPLE directory use coupling ideas discussed on
the <a class="reference internal" href="Howto_couple.html"><span class="doc">Howto couple</span></a> doc page.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Build_basics.html" class="btn btn-neutral float-right" title="3.4. Basic build options" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Build_make.html" class="btn btn-neutral" title="3.2. Build LAMMPS with make" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr style="margin-top: 6px; margin-bottom: 6px;" width="100%"/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2003-2020 Sandia Corporation.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="_static/mathjax/es5/tex-mml-chtml.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>