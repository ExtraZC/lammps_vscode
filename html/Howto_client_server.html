

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.2.7. Using LAMMPS in client/server mode &mdash; LAMMPS documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="LAMMPS documentation" href="index.html"/>
        <link rel="up" title="8. Howto discussions" href="Howto.html"/>
        <link rel="next" title="8.3.1. 2d simulations" href="Howto_2d.html"/>
        <link rel="prev" title="8.2.6. Coupling LAMMPS to other codes" href="Howto_couple.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="Manual.html">
        

        
          
          <img src="_static/lammps-logo.png" class="logo" />
        
        </a>

        <div class="lammps_version">Version: <b>19 Mar 2020</b></div>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">2. Install LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build.html">3. Build LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Run_head.html">4. Run LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Commands.html">5. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Packages.html">6. Optional packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Speed.html">7. Accelerate performance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Howto.html">8. Howto discussions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Howto.html#tutorials-howto">8.1. Tutorials howto</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="Howto.html#general-howto">8.2. General howto</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Howto_restart.html">8.2.1. Restart a simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_viz.html">8.2.2. Visualize LAMMPS snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_multiple.html">8.2.3. Run multiple simulations from one input script</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_replica.html">8.2.4. Multi-replica simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_library.html">8.2.5. Library interface to LAMMPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Howto_couple.html">8.2.6. Coupling LAMMPS to other codes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">8.2.7. Using LAMMPS in client/server mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#settings-howto">8.3. Settings howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#analysis-howto">8.4. Analysis howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#force-fields-howto">8.5. Force fields howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="Howto.html#packages-howto">8.6. Packages howto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">9. Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">10. Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modify.html">11. Modify &amp; extend LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_head.html">12. Use Python with LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Errors.html">13. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Manual_build.html">14. Building the LAMMPS manual</a></li>
</ul>
<p class="caption"><span class="caption-text">Index</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="commands_list.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixes.html">Fixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="computes.html">Computes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairs.html">Pair Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonds.html">Bond Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="angles.html">Angle Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dihedrals.html">Dihedral Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="impropers.html">Improper Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="fix_modify_atc_commands.html">fix_modify AtC commands</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="Manual.html">LAMMPS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="Manual.html">Docs</a> &raquo;</li>
      
          <li><a href="Howto.html"><span class="section-number">8. </span>Howto discussions</a> &raquo;</li>
      
    <li><span class="section-number">8.2.7. </span>Using LAMMPS in client/server mode</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="http://lammps.sandia.gov">Website</a>
            <a href="Commands_all.html">Commands</a>
        
      </li>
  </ul>
  <hr style="margin-top: 6px; margin-bottom: 6px;" width="100%"/>
  
    <div class="rst-footer-buttons" style="margin-bottom: 1em" role="navigation" aria-label="footer navigation">
      
        <a href="Howto_2d.html" class="btn btn-neutral float-right" title="8.3.1. 2d simulations" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Howto_couple.html" class="btn btn-neutral" title="8.2.6. Coupling LAMMPS to other codes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-lammps-in-client-server-mode">
<h1><span class="section-number">8.2.7. </span>Using LAMMPS in client/server mode</h1>
<p>Client/server coupling of two codes is where one code is the “client”
and sends request messages to a “server” code.  The server responds to
each request with a reply message.  This enables the two codes to work
in tandem to perform a simulation.  LAMMPS can act as either a client
or server code.</p>
<p>Some advantages of client/server coupling are that the two codes run
as stand-alone executables; they are not linked together.  Thus
neither code needs to have a library interface.  This often makes it
easier to run the two codes on different numbers of processors.  If a
message protocol (format and content) is defined for a particular kind
of simulation, then in principle any code that implements the
client-side protocol can be used in tandem with any code that
implements the server-side protocol, without the two codes needing to
know anything more specific about each other.</p>
<p>A simple example of client/server coupling is where LAMMPS is the
client code performing MD timestepping.  Each timestep it sends a
message to a server quantum code containing current coords of all the
atoms.  The quantum code computes energy and forces based on the
coords.  It returns them as a message to LAMMPS, which completes the
timestep.</p>
<p>A more complex example is where LAMMPS is the client code and
processes a series of data files, sending each configuration to a
quantum code to compute energy and forces.  Or LAMMPS runs dynamics
with an atomistic force field, but pauses every N steps to ask the
quantum code to compute energy and forces.</p>
<p>Alternate methods for code coupling with LAMMPS are described on
the <a class="reference internal" href="Howto_couple.html"><span class="doc">Howto couple</span></a> doc page.</p>
<p>The protocol for using LAMMPS as a client is to use these 3 commands
in this order (other commands may come in between):</p>
<ul class="simple">
<li><p><a class="reference internal" href="message.html"><span class="doc">message client</span></a>  # initiate client/server interaction</p></li>
<li><p><a class="reference internal" href="fix_client_md.html"><span class="doc">fix client/md</span></a>   # any client fix which makes specific requests to the server</p></li>
<li><p><a class="reference internal" href="message.html"><span class="doc">message quit</span></a>    # terminate client/server interaction</p></li>
</ul>
<p>In between the two message commands, a client fix command and
<a class="reference internal" href="unfix.html"><span class="doc">unfix</span></a> command can be used multiple times.  Similarly,
this sequence of 3 commands can be repeated multiple times, assuming
the server program operates in a similar fashion, to initiate and
terminate client/server communication.</p>
<p>The protocol for using LAMMPS as a server is to use these 2 commands
in this order (other commands may come in between):</p>
<ul class="simple">
<li><p><a class="reference internal" href="message.html"><span class="doc">message server</span></a>  # initiate client/server interaction</p></li>
<li><p><a class="reference internal" href="server_md.html"><span class="doc">server md</span></a>    # any server command which responds to specific requests from the client</p></li>
</ul>
<p>This sequence of 2 commands can be repeated multiple times, assuming
the client program operates in a similar fashion, to initiate and
terminate client/server communication.</p>
<p>LAMMPS support for client/server coupling is in its <a class="reference internal" href="Packages_details.html#pkg-message"><span class="std std-ref">MESSAGE package</span></a> which implements several
commands that enable LAMMPS to act as a client or server, as discussed
below.  The MESSAGE package also wraps a client/server library called
CSlib which enables two codes to exchange messages in different ways,
either via files, sockets, or MPI.  The CSlib is provided with LAMMPS
in the lib/message dir.  The CSlib has its own
<a class="reference external" href="https://cslib.sandia.gov">website</a> with documentation and test
programs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For client/server coupling to work between LAMMPS and another
code, the other code also has to use the CSlib.  This can sometimes be
done without any modifications to the other code by simply wrapping it
with a Python script that exchanges CSlib messages with LAMMPS and
prepares input for or processes output from the other code.  The other
code also has to implement a matching protocol for the format and
content of messages that LAMMPS exchanges with it.</p>
</div>
<p>These are the commands currently in the MESSAGE package for two
protocols, MD and MC (Monte Carlo).  New protocols can easily be
defined and added to this directory, where LAMMPS acts as either the
client or server.</p>
<ul class="simple">
<li><p><a class="reference internal" href="message.html"><span class="doc">message</span></a></p></li>
<li><p><a class="reference internal" href="fix_client_md.html"><span class="doc">fix client md</span></a> = LAMMPS is a client for running MD</p></li>
<li><p><a class="reference internal" href="server_md.html"><span class="doc">server md</span></a> = LAMMPS is a server for computing MD forces</p></li>
<li><p><a class="reference internal" href="server_mc.html"><span class="doc">server mc</span></a> = LAMMPS is a server for computing a Monte Carlo energy</p></li>
</ul>
<p>The server doc files give details of the message protocols
for data that is exchanged between the client and server.</p>
<p>These example directories illustrate how to use LAMMPS as either a
client or server code:</p>
<ul class="simple">
<li><p>examples/message</p></li>
<li><p>examples/COUPLE/README</p></li>
<li><p>examples/COUPLE/lammps_mc</p></li>
<li><p>examples/COUPLE/lammps_nwchem</p></li>
<li><p>examples/COUPLE/lammps_vasp</p></li>
</ul>
<p>The examples/message directory couples a client instance of LAMMPS to a
server instance of LAMMPS.</p>
<p>The files in the <em>lammps_mc</em> folder show how to couple LAMMPS as
a server to a simple Monte Carlo client code as the driver.</p>
<p>The files in the <em>lammps_nwchem</em> folder show how to couple LAMMPS
as a client code running MD timestepping to NWChem acting as a
server providing quantum DFT forces, through a Python wrapper script
on NWChem.</p>
<p>The files in the <em>lammps_vasp</em> folder show how to couple LAMMPS as
a client code running MD timestepping to VASP acting as a server
providing quantum DFT forces, through a Python wrapper script on VASP.</p>
<p>Here is how to launch a client and server code together for any of the
4 modes of message exchange that the <a class="reference internal" href="message.html"><span class="doc">message</span></a> command
and the CSlib support.  Here LAMMPS is used as both the client and
server code.  Another code could be substituted for either.</p>
<p>The examples below show launching both codes from the same window (or
batch script), using the “&amp;” character to launch the first code in the
background.  For all modes except <em>mpi/one</em>, you could also launch the
codes in separate windows on your desktop machine.  It does not
matter whether you launch the client or server first.</p>
<p>In these examples either code can be run on one or more processors.
If running in a non-MPI mode (file or zmq) you can launch a code on a
single processor without using mpirun.</p>
<p>IMPORTANT: If you run in mpi/two mode, you must launch both codes via
mpirun, even if one or both of them runs on a single processor.  This
is so that MPI can figure out how to connect both MPI processes
together to exchange MPI messages between them.</p>
<p>For message exchange in <em>file</em>, <em>zmq</em>, or <em>mpi/two</em> modes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% mpirun -np <span class="m">1</span> lmp_mpi -log log.client &lt; in.client <span class="p">&amp;</span>
% mpirun -np <span class="m">2</span> lmp_mpi -log log.server &lt; in.server

% mpirun -np <span class="m">4</span> lmp_mpi -log log.client &lt; in.client <span class="p">&amp;</span>
% mpirun -np <span class="m">1</span> lmp_mpi -log log.server &lt; in.server

% mpirun -np <span class="m">2</span> lmp_mpi -log log.client &lt; in.client <span class="p">&amp;</span>
% mpirun -np <span class="m">4</span> lmp_mpi -log log.server &lt; in.server
</pre></div>
</div>
<p>For message exchange in <em>mpi/one</em> mode:</p>
<p>Launch both codes in a single mpirun command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="m">2</span> lmp_mpi -mpicolor <span class="m">0</span> -in in.message.client -log log.client : -np <span class="m">4</span> lmp_mpi -mpicolor <span class="m">1</span> -in in.message.server -log log.server
</pre></div>
</div>
<p>The two -np values determine how many procs the client and the server
run on.</p>
<p>A LAMMPS executable run in this manner must use the -mpicolor color
command-line option as their its option, where color is an integer
label that will be used to distinguish one executable from another in
the multiple executables that the mpirun command launches.  In this
example the client was colored with a 0, and the server with a 1.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Howto_2d.html" class="btn btn-neutral float-right" title="8.3.1. 2d simulations" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Howto_couple.html" class="btn btn-neutral" title="8.2.6. Coupling LAMMPS to other codes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr style="margin-top: 6px; margin-bottom: 6px;" width="100%"/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2003-2020 Sandia Corporation.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="_static/mathjax/es5/tex-mml-chtml.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>